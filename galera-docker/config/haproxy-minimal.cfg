global
    maxconn 4096
    stats socket /var/run/haproxy.sock mode 600 level admin
    stats timeout 2m
    
defaults
    mode tcp
    timeout connect 10s
    timeout client 1m
    timeout server 1m
    timeout check 10s
    log global

listen stats
    mode http
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if TRUE

listen mysql-cluster
    bind *:3306
    mode tcp
    balance leastconn
    option mysql-check user clustercheck password clustercheck
    default-server port 3306 inter 2s downinter 5s rise 3 fall 2 slowstart 60s maxconn 64 maxqueue 128 weight 100
    
    server pxc1 pxc1:3306 check
    server pxc2 pxc2:3306 check
    server pxc3 pxc3:3306 check